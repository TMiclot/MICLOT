[User Guide home](Manual.md)

# Data analysis

All commands come from `miclot.analysis`

This module is composed of three main classes. Each has a specific use:

- `cleaning` : to generate clean data
- `concatenate` : to concatenate clean data as unique file
- `plot` : for plotting graphs (plots, clustered heatmaps, graph, ...)
- `remove` : to delete unwanted files in a directory

Classes have their own properties to ensure diffrents functions.


# A. Class `cleaning`

## A.1. Overview

**cleaning**.*property*

### Description

Clean raw data generated by commands.

### Properties

| Property | Description | Return |
| -------- | --- | --- |
| .structure | Clean structure information. | pandas dataframe & CSV file | 
| .neighbor_residues  | Search for neighbor residues. | pandas dataframe & CSV file |
| .interactions_table | Clean the interaction table.  | pandas dataframe & CSV file |


## A.2. Clean structure information

**.structure**(directory, *file_name_structure='residues_secondaryStructure_and_COMs', file_name_protein_region='residues_protein_region', pdb_name=None, save=True*)

### Description

Clean structure information files. It use CSV files:

- *residues_secondaryStructure_and_COMs.csv
- *residues_protein_region.csv &emsp; &emsp; *If it don't exist, protein_region and identity will be replaced by 'No'*
        
The final table contain: chainID, index, name, secondary structure, protein region (for complex), identity (for complex), code complete, code simplified, distances: COM_COMsidechain, COM_COMbackbone, COMsidechain_COMbackbone

### Arguments

| Argument | Format | Description | Requirement |
| -------- | --- | --- | --- |
| directory | string | directory containing all subdirectory where CSV files are located. | mandatory |
| file_name_structure | string | File name of CSV containing raw struture data. <br/> Default value: 'residues_secondaryStructure_and_COMs' | optional |
| file_name_protein_region | string | File name of CSV containing raw protein region data. <br/> Default value: 'residues_protein_region' | optional |
| pdb_name | string | structure name to use in the exported file. <br/> Default value: directory name | optional |
| save | boolean | save or not the final CSV file. <br/> Default value: True | optional |

### Returns

The command return the concatenated final file as pandas dataframe and wrote it as CSV file.




## A.3. Search for neighbor residues

**.neighbor_residues**(directory, *file_name_clean_structure='clean_structure', file_name_distance_map='distance_map', neighbor_cutoff_distance=8, distance_columns=None, pdb_name=None, save=True*)

### Description

Use the distance map to identify neighbor residues based on their COMs distances.

### Arguments

| Argument | Format | Description | Requirement |
| -------- | ------ | ----------- | ----------- |
| directory | string | directory containing all subdirectory where CSV files are located. | mandatory |
| file_name_clean_structure | string | File name of CSV containing clean struture data. <br/> Default value: 'clean_structure' | optional |
| file_name_distance_map | string | File name of CSV of the distance map. *This file is automaticaly generated if it don't exist.* <br/> Default value: 'distance_map' | optional |
| neighbor_cutoff_distance | float | Distance cuttoff to identify residue neighbors. Value is in Å <br/> Default value: 8 Å | optional |
| pdb_name | string | structure name to use in the exported file. <br/> Default value: directory name | optional |
| save | boolean | save or not the final CSV file. <br/> Default value: True | optional 

### Returns

The command return the concatenated final file as pandas dataframe and wrote it as CSV file.




## A.4. Clean the interaction table

**.interactions_table**(directory, *file_name_clean_structure='clean_structure', file_name_interaction_table='interaction_table_whole_system', file_name_distance_map='distance_map', pdb_name=None, save=True*)

### Description

Clean the interaction table and use the distance map to add residues pair COMs distances.

### Arguments

| Argument | Format | Description | Requirement |
| -------- | ------ | ----------- | ----------- |
| directory | string | directory containing all subdirectory where CSV files are located. | mandatory |
| file_name_interaction_table | string | Name of file containing raw interaction types information. <br/> Default value: 'interaction_table_whole_system' | optional |
| file_name_clean_structure | string | File name of CSV containing clean struture data. <br/> Default value: 'clean_structure' | optional |
| file_name_distance_map | string | File name of CSV of the distance map. *This file is automaticaly generated if it don't exist.* <br/> Default value: 'distance_map' | optional |
| pdb_name | string | structure name to use in the exported file. <br/> Default value: directory name | optional |
| save | boolean | save or not the final CSV file. <br/> Default value: True| optional 

### Returns

The command return the concatenated final file as pandas dataframe and wrote it as CSV file.



## A.5. Search for neighbor pairs

**.clean_neighbor_pairs**(directory, *file_name_clean_interactions_table='clean_interactions_table', file_name_neighbor_residues='clean_neighbor_residues', pdb_name=None, save=True*)

### Description

Identify neighbor pairs using the neighbor residue and interactions table.

### Arguments

| Argument | Format | Description | Requirement |
| -------- | ------ | ----------- | ----------- |
| directory | string | directory containing all subdirectory where CSV files are located. | mandatory |
| file_name_clean_interactions_table | string | Name of file containing raw interaction types information. <br/> Default value: 'clean_interactions_table' | optional |
| file_name_neighbor_residues | string | File name of CSV containing clean struture data. <br/> Default value: 'clean_neighbor_residues' | optional |
| pdb_name | string | structure name to use in the exported file. <br/> Default value: directory name | optional |
| save | boolean | save or not the final CSV file. <br/> Default value: True| optional 

### Returns

The command return the concatenated final file as pandas dataframe and wrote it as CSV file.





# B. Class `concatenate`

## B.1. Overview

**concatenate**.*property*

### Description

Concatenate CSV files into a single final file. A log file is always writen to 

### Properties

| Property | Description | Return |
| -------- | --- | --- |
| .csv_file | Concatenate any CSV files.     | final pandas dataframe and write CSV file |
| .ASA      | Concatenate ASA related files. | final pandas dataframe and write CSV file |
| .interaction_table | Concatenate interaction table files.         | final pandas dataframe and write CSV file |
| .neighbor_residues | Concatenate neighbor residues related files. | final pandas dataframe and write CSV file |
| .neighbor_pairs    | Concatenate neighbor pairs related files.    | final pandas dataframe and write CSV file |
| .structure         | Concatenate structure files.                 | final pandas dataframe and write CSV file |




## B.2. Concatenate any CSV files

**.csv_file**(directory, file_name, *final_file_name=None, logfile_name=None, use_tqdm=False*)

### Description

Concatenate CSV files in all subdirectory, based on their file name or motif in their name, then write a final CSV file.
The final file is automatically save as CSV in the directory.

>[!IMPORTANT]
> If you don't work on ASA file, avoid file name containing *ASA_complex_receptor_ligand_and_interface*.

### Arguments

| Argument | Format | Description | Requirement |
| -------- | --- | --- | --- |
| directory | string | directory containing all subdirectory where CSV files are located. | mandatory |
| file_name | string | file name, or motif in the name, of files to be concatenated. | mandatory |
| final_file_name | string | directory containing all subdirectory where CSV file are located. | optinal |
| logfile_name | string | name for the log file. It is automatically save in the directory. | optinal |
| use_tqdm | boolean | use tqdm progress bar. <br/> Default: False | optinal |

### Returns

The command return the concatenated final file as pandas dataframe and wrote it as CSV file.



## B.2. Concatenate files containing ASA information

**.ASA**(directory,* use_tqdm=False*)

### Description

Simplify concatenation of ASA information, file selected based on name containing *ASA_complex_receptor_ligand_and_interface.csv*.

### Arguments

| Argument | Format | Description | Requirement |
| -------- | --- | --- | --- |
| directory | string | directory containing all subdirectory where CSV files are located. | mandatory |
| use_tqdm  | boolean | use tqdm progress bar. <br/> Default: False | optinal |

### Returns

The command return the concatenated final file as pandas dataframe and wrote it as CSV file.



## B.3. Concatenate interaction types tables

**.interaction_table**(directory,* use_tqdm=False*)

### Description

Simplify concatenation of interaction tables, file selected based on name containing *clean_interactions_table.csv*.

### Arguments

| Argument | Format | Description | Requirement |
| -------- | --- | --- | --- |
| directory | string | directory containing all subdirectory where CSV files are located. | mandatory |
| use_tqdm  | boolean | use tqdm progress bar. <br/> Default: False | optinal |

### Returns

The command return the concatenated final file as pandas dataframe and wrote it as CSV file.



## B.4. Concatenate neighbor residues tables

**.neighbor_residues**(directory,* use_tqdm=False*)

### Description

Simplify concatenation of neighbor residue information, file selected based on name containing *clean_neighbor_residues.csv*.

### Arguments

| Argument | Format | Description | Requirement |
| -------- | --- | --- | --- |
| directory | string | directory containing all subdirectory where CSV files are located. | mandatory |
| use_tqdm  | boolean | use tqdm progress bar. <br/> Default: False | optinal |

### Returns

The command return the concatenated final file as pandas dataframe and wrote it as CSV file.




## B.6. Concatenate neighbor pairs tables

**.neighbor_pairs**(directory,* use_tqdm=False*)

### Description

Simplify concatenation of neighbor pairs information, file selected based on name containing *clean_neighbor_pairs.csv*.

### Arguments

| Argument | Format | Description | Requirement |
| -------- | --- | --- | --- |
| directory | string | directory containing all subdirectory where CSV files are located. | mandatory |
| use_tqdm  | boolean | use tqdm progress bar. <br/> Default: False | optinal |

### Returns

The command return the concatenated final file as pandas dataframe and wrote it as CSV file.






# C. Class `plot`

## C.1. Overview

**plot**.*property*

### Description

Select a directory where to remove unwanted files.

### Properties

| Property | Description | Return |
| -------- | --- | --- |
| .minimization   | Plot minimization energies from a directory or a file. | graph in Matplotlib format |



## C.2. Plot minimization energies

**.minimization**(path, *name=None, fig_size=[15, 4], linewidth=2, save=False, dpi=300*)

### Description

Read the CSV file written during the minimisation and plot:

- System energy
- Harmonic restraints energy
- Restraint force constant
- Constraint maximum relative error

### Arguments

| Argument | Format | Description | Requirement |
| -------- | --- | --- | --- |
| path     | string  | directory or file path | mandatory |
| fig_size | list of float | Width, height in inches. <br/> Default: [15, 4] | optional |
| linewidth | float  | Set the line width. <br/> Default: 2.5  | optional |
| save     | boolean | Save the graph as PNG in the directory. <br/> Dafault: False | optional |
| dpi      | float   | The resolution of the figure in dots-per-inch. <br/> Default: 300 | optional |
| name     | string  | directory or file path | optional |

### Returns

The command return the graph in Matplotlib format.







# D. Class `remove`

## D.1. Overview

**remove**.*property*

### Description

Select a directory where to remove unwanted files.

### Properties

| Property | Description | Return |
| -------- | --- | --- |
| .plots   | Remove all generated plots. | list_removed, list_error |
| .clean_data | Remove all generated cleaned data. | list_removed, list_error |
| .file | Remove any file. | list_removed, list_error |



## D.2. Remove all generated clean data

**.clean_data**(directory)

### Description

Remove all generated cleaned data.

It is based of the file format: 'csv' and file name containing 'clean'

### Return

- list_removed : list containing the path of all removed file
- list_error : list containing the path of all files that could not be removed





## D.3. Remove all generated clean data

**.pickles**(directory)

### Description

Remove all backub file in compressed pickle format generated by [`interaction_table_whole_system`](__usage_identify_nonbonded_interactions.md#identify-all-interfactions-in-a-protein-or-a-complex)

It is based of the file format: 'pkl.gz' and file name containing 'class'

### Return

- list_removed : list containing the path of all removed file
- list_error : list containing the path of all files that could not be removed




## D.4. Remove all generated plots

**.files**(directory, name, file_format)

### Description

Remove any file(s) using the name (or a motif in name) and the file format.

### Arguments

| Argument | Format | Description | Requirement |
| -------- | --- | --- | --- |
| name | string  | file name, or motif in the file name | mandatory |
| file_format | string  | file format, without the dot. <br/> Example: 'png'| mandatory |

### Return

- list_removed : list containing the path of all removed file
- list_error : list containing the path of all files that could not be removed





# E. Other

**make_distance_map**(directory, *file_name_structure='residues_secondaryStructure_and_COMs', pdb_name=None, save=True*)

> [!IMPORTANT]
> Normally the distance map is automatically generated by `neighbor_residues` or `neighbor_pairs` commands if the file **.distance_map.csv* don't exist. But if any problem occure, it'is possible to regenerate it using this command to (re)generate it.


    DESCRIPTION
        Calculate all COMs distances and generate a CSV file with these values.

    ARGUMENTS
        directory     directory where CSV files are located
        
    OPTINAL ARGUMENTS
        file_name_structure    Name of file containing secondary structure and COMs information.
                               Default value: 'residues_secondaryStructure_and_COMs'
                                    
        pdb_name    structure name to use in the clened file: {pdb_name}_distance_map.csv
                    Default value: directory name
                    
        save        save cleaned file as CSV in the directory
                    Default value: True